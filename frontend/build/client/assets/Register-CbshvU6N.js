import{w as z}from"./with-props-BqwZr1IK.js";import{r as n,j as e,a as C,b as L,L as P}from"./chunk-IR6S3I6Y-C6Zvu3tq.js";import{G as T,u as I}from"./UserContext-BcfRxPbJ.js";import{d as U}from"./debounce-CDx3-cb2.js";import{P as G}from"./PageTransition-1p6Ne89E.js";import"./proxy-7hmYPAw3.js";const V=({onRegisterSuccess:g})=>{const[c,d]=n.useState({email:"",first_name:"",last_name:"",display_name:"",password:"",password2:""}),[u,m]=n.useState(""),i=async t=>{t.preventDefault();try{const l=await fetch("/api/auth/volunteer/register/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),f=await l.json();if(!l.ok)throw new Error(f.error||"Registration failed");g(f)}catch(l){m(l.message)}},p=async t=>{try{const l=await fetch("/api/auth/google/callback/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:t.credential,user_type:"volunteer"})}),f=await l.json();if(!l.ok)throw new Error("Google registration failed");g(f)}catch(l){m(l.message)}};return e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[u&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 text-red-700 rounded",children:u}),e.jsx(T,{onSuccess:p,onError:()=>m("Google registration failed"),className:"w-full mb-4",containerProps:{allow:"identity-credentials-get"},use_fedcm_for_prompt:!0}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with email"})})]}),e.jsxs("form",{className:"space-y-6",onSubmit:i,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email address"}),e.jsx("input",{id:"email",type:"email",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>d({...c,email:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"first_name",className:"block text-sm font-medium text-gray-700",children:"First Name"}),e.jsx("input",{id:"first_name",type:"first_name",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>d({...c,first_name:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"last_name",className:"block text-sm font-medium text-gray-700",children:"Last Name"}),e.jsx("input",{id:"last_name",type:"last_name",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>d({...c,last_name:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"display_name",className:"block text-sm font-medium text-gray-700",children:"Display Name"}),e.jsx("input",{id:"display_name",type:"display_name",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>d({...c,display_name:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsx("input",{id:"password",type:"password",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>d({...c,password:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password2",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),e.jsx("input",{id:"password2",type:"password",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>d({...c,password2:t.target.value})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Sign up"})})]})]})},J=({onRegisterSuccess:g})=>{const[c,d]=n.useState(1),[u,m]=n.useState({name:"",charity_number:"",description:"",logo:null,selected_charity_data:null,contact_info:null}),[i,p]=n.useState({email:"",username:"",password:"",password2:""}),[t,l]=n.useState({verified:!1,message:"",charityDomain:"",requiresManualApproval:!1,manualApprovalRequested:!1}),[f,x]=n.useState(""),[R,S]=n.useState(""),[w,y]=n.useState([]),[D,v]=n.useState(!1),[Y,b]=n.useState(!1),j=n.useRef(null),k=C();n.useEffect(()=>{i.email&&t.charityDomain&&q()},[i.email,t.charityDomain]);const q=()=>{const s=i.email.split("@")[1],a=t.charityDomain;if(!s){l(o=>({...o,verified:!1,message:"Please enter a valid email address",requiresManualApproval:!1}));return}l(s===a?o=>({...o,verified:!0,message:`Email verified with domain ${a}`,requiresManualApproval:!1,manualApprovalRequested:!1}):o=>({...o,verified:!1,message:`Email domain doesn't match charity domain ${a||"unknown"}`,requiresManualApproval:!0}))};n.useEffect(()=>{const s=a=>{j.current&&!j.current.contains(a.target)&&b(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const N=n.useRef(U(async s=>{if(s.length<3){y([]),v(!1);return}v(!0);try{const r=(await(await fetch(`/api/charity-search/?q=${encodeURIComponent(s)}`)).json()).sort((h,_)=>h.reg_status==="RM"&&_.reg_status!=="RM"?1:h.reg_status!=="RM"&&_.reg_status==="RM"?-1:h.charity_name.localeCompare(_.charity_name));y(r),r&&r.length>0&&b(!0)}catch(a){console.error("Search failed:",a)}finally{v(!1)}},700)).current;n.useEffect(()=>()=>{N.cancel()},[N]);const E=s=>{const a=s.target.value;S(a),a.length<3?(y([]),b(!1)):(v(!0),N(a))},A=async(s,a=0)=>{try{const r=await(await fetch(`/api/charity-details/${s}/${a}`)).json();r.activities&&m(h=>({...h,description:r.activities})),await F(s,a)}catch(o){console.error("Failed to fetch charity details:",o)}},F=async(s,a=0)=>{try{const r=await(await fetch(`/api/charity-contact-information/${s}/${a}`)).json();m(h=>({...h,contact_info:r})),r.web&&l(h=>({...h,charityDomain:r.web}))}catch(o){console.error("Failed to fetch charity contact info:",o)}},$=s=>{m(a=>({...a,name:s.charity_name,charity_number:s.reg_charity_number,selected_charity_data:s})),S(s.charity_name),y([]),b(!1),s.reg_charity_number&&A(s.reg_charity_number,s.group_subsid_suffix||0)},O=async s=>{s.preventDefault();const a=new FormData,o={...u,...i,domain_verified:t.verified,manual_approval_requested:t.manualApprovalRequested};Object.keys(o).forEach(r=>{r==="selected_charity_data"&&o[r]||r==="contact_info"&&o[r]?a.append(r,JSON.stringify(o[r])):o[r]!==null&&a.append(r,o[r])});try{const r=await fetch("/api/auth/organization/register/",{method:"POST",body:a}),h=await r.json();if(!r.ok)throw new Error(h.error||"Registration failed");t.verified?k("/verify-organization",{state:{email:i.email}}):k("/login",{state:{message:"Your organization registration requires manual approval. You will receive an email when your account is approved."}})}catch(r){x(r.message)}},M=e.jsxs("div",{className:"relative",ref:j,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Search Registered Charity"}),e.jsx("input",{type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter charity name or number (min 3 characters)",value:R,onChange:E,onFocus:()=>{w.length>0&&b(!0)}}),D&&e.jsx("div",{className:"absolute right-3 top-9",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),w.length>0&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto max-h-60",children:w.map(s=>e.jsxs("div",{className:"cursor-pointer hover:bg-gray-100 py-2 px-4",onClick:()=>$(s),children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.charity_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Charity Number: ",s.reg_charity_number,s.reg_status==="RM"&&e.jsx("span",{className:"ml-2 text-red-500",children:"(Removed)"})]}),s.date_of_registration&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Registered: ",new Date(s.date_of_registration).toLocaleDateString()]})]},`${s.reg_charity_number}-${s.organisation_number}`))})]});return e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[f&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 text-red-700 rounded",children:f}),e.jsx("div",{className:"mb-5",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex",children:[e.jsx("button",{onClick:()=>d(1),className:`${c===1?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm`,children:"Organization Details"}),e.jsx("button",{onClick:()=>d(2),className:`${c===2?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm`,children:"Admin User"})]})})}),e.jsx("form",{className:"space-y-6",onSubmit:O,children:c===1?e.jsxs(e.Fragment,{children:[M,e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{required:!0,rows:4,value:u.description,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>m({...u,description:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Organization Logo"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsxs("label",{className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[e.jsxs("span",{className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"-ml-1 mr-2 h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Choose File"]}),e.jsx("input",{type:"file",className:"sr-only",accept:"image/*",onChange:s=>m({...u,logo:s.target.files[0]})})]}),u.logo&&e.jsx("span",{className:"ml-3 text-sm text-gray-600",children:u.logo.name})]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:()=>d(2),className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Next"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("input",{type:"email",required:!0,value:i.email,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>p({...i,email:s.target.value})}),t.charityDomain&&i.email&&e.jsx("div",{className:`mt-1 text-sm ${t.verified?"text-green-600":"text-yellow-600"}`,children:t.message}),t.requiresManualApproval&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center h-5",children:e.jsx("input",{id:"manual-approval",name:"manual-approval",type:"checkbox",checked:t.manualApprovalRequested,onChange:s=>l({...t,manualApprovalRequested:s.target.checked}),className:"focus:ring-blue-500 h-4 w-4 text-blue-600 border-gray-300 rounded"})}),e.jsxs("div",{className:"ml-3 text-sm",children:[e.jsx("label",{htmlFor:"manual-approval",className:"font-medium text-gray-700",children:"Request Manual Approval"}),e.jsx("p",{className:"text-gray-500",children:"Your email doesn't match the charity's domain. Check this box to request manual verification. Note: No verification email will be sent and admin approval will be required."})]})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Username"}),e.jsx("input",{type:"text",required:!0,value:i.username,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>p({...i,username:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsx("input",{type:"password",required:!0,value:i.password,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>p({...i,password:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),e.jsx("input",{type:"password",required:!0,value:i.password2,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>p({...i,password2:s.target.value})})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>d(1),className:"w-1/2 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Back"}),e.jsx("button",{type:"submit",disabled:!t.verified&&!t.manualApprovalRequested,className:`w-1/2 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ${!t.verified&&!t.manualApprovalRequested?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}`,children:"Register"})]})]})})]})},B=()=>{const g=L(),c=C(),{login:d}=I(),[u,m]=n.useState("volunteer"),[i,p]=n.useState({}),[t,l]=n.useState("");n.useEffect(()=>{var x;(x=g.state)!=null&&x.type&&m(g.state.type)},[g]);const f=x=>{localStorage.setItem("access_token",x.access),localStorage.setItem("refresh_token",x.refresh),d(x.user),x.user.is_volunteer?c("/browse"):c("/dashboard")};return e.jsx(G,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Create your account"}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs("div",{className:"inline-flex rounded-md",role:"group",children:[e.jsx("button",{onClick:()=>m("volunteer"),className:`px-4 py-2 text-sm font-medium rounded-l-md ${u==="volunteer"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:"Volunteer"}),e.jsx("button",{onClick:()=>m("organization"),className:`px-4 py-2 text-sm font-medium rounded-r-md ${u==="organization"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:"Organization"})]})})]}),e.jsxs("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:[u==="volunteer"?e.jsx(V,{onRegisterSuccess:f}):e.jsx(J,{onRegisterSuccess:f}),e.jsxs("p",{className:"mt-6 text-center text-sm text-gray-600",children:["Already have an account?"," ",e.jsx(P,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500",children:"Sign in"})]})]})]})})},ee=z(B);export{ee as default};
