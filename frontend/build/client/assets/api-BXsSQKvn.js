const h="/api",l={async request(e,t={}){const o=`${h}${e}`,a=localStorage.getItem("access_token"),f={"Content-Type":"application/json",...a&&{Authorization:`Bearer ${a}`}},s={...t,headers:{...f,...t.headers}};try{const r=await fetch(o,s);if(r.status===401&&!s._retry){const n=localStorage.getItem("refresh_token");if(!n)throw new Error("No refresh token available");const i=await fetch(`${h}/token/refresh/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh:n})});if(!i.ok)throw new Error("Token refresh failed");const{access:c}=await i.json();return localStorage.setItem("access_token",c),s.headers.Authorization=`Bearer ${c}`,s._retry=!0,this.request(e,s)}if(!r.ok)throw new Error(r.statusText);return r.json()}catch(r){throw r.message==="Token refresh failed"&&(localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),window.location.href="/login"),r}},get(e,t={}){return this.request(e,{...t,method:"GET"})},post(e,t,o={}){return this.request(e,{...o,method:"POST",body:JSON.stringify(t)})},put(e,t,o={}){return this.request(e,{...o,method:"PUT",body:JSON.stringify(t)})},delete(e,t={}){return this.request(e,{...t,method:"DELETE"})}};export{l as a};
