import{w as E}from"./proxy-BvCMkRSn.js";import{a,n as e,v as F,o as O,L as q}from"./chunk-HA7DTUK3-Dw2W5fJk.js";import{b as L,u as P}from"./UserContext-CLETiZQn.js";import{d as z}from"./debounce-CMly-wnW.js";import{P as $}from"./PageTransition-DzrlKaVj.js";const T=({onRegisterSuccess:g})=>{const[n,l]=a.useState({email:"",first_name:"",last_name:"",display_name:"",password:"",password2:""}),[i,c]=a.useState(""),d=async t=>{t.preventDefault();try{const u=await fetch("/api/auth/volunteer/register/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),x=await u.json();if(!u.ok)throw new Error(x.error||"Registration failed");g(x)}catch(u){c(u.message)}},b=async t=>{try{const u=await fetch("/api/auth/google/callback/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:t.credential,user_type:"volunteer"})}),x=await u.json();if(!u.ok)throw new Error("Google registration failed");g(x)}catch(u){c(u.message)}};return e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[i&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 text-red-700 rounded",children:i}),e.jsx(L,{onSuccess:b,onError:()=>c("Google registration failed"),className:"w-full mb-4",containerProps:{allow:"identity-credentials-get"},use_fedcm_for_prompt:!0}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with email"})})]}),e.jsxs("form",{className:"space-y-6",onSubmit:d,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email address"}),e.jsx("input",{id:"email",type:"email",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>l({...n,email:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"first_name",className:"block text-sm font-medium text-gray-700",children:"First Name"}),e.jsx("input",{id:"first_name",type:"first_name",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>l({...n,first_name:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"last_name",className:"block text-sm font-medium text-gray-700",children:"Last Name"}),e.jsx("input",{id:"last_name",type:"last_name",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>l({...n,last_name:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"display_name",className:"block text-sm font-medium text-gray-700",children:"Display Name"}),e.jsx("input",{id:"display_name",type:"display_name",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>l({...n,display_name:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsx("input",{id:"password",type:"password",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>l({...n,password:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password2",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),e.jsx("input",{id:"password2",type:"password",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>l({...n,password2:t.target.value})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Sign up"})})]})]})},M=({onRegisterSuccess:g})=>{const[n,l]=a.useState(1),[i,c]=a.useState({name:"",charity_number:"",description:"",logo:null,selected_charity_data:null}),[d,b]=a.useState({email:"",username:"",password:"",password2:""}),[t,u]=a.useState(""),[x,m]=a.useState(""),[w,p]=a.useState([]),[_,y]=a.useState(!1),j=a.useRef(null);a.useEffect(()=>{const s=o=>{j.current&&!j.current.contains(o.target)&&setShowResults(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const v=a.useRef(z(async s=>{if(s.length<3){p([]),y(!1);return}y(!0);try{const r=(await(await fetch(`/api/charity-search/?q=${encodeURIComponent(s)}`)).json()).sort((f,N)=>f.reg_status==="RM"&&N.reg_status!=="RM"?1:f.reg_status!=="RM"&&N.reg_status==="RM"?-1:f.charity_name.localeCompare(N.charity_name));p(r),r&&r.length>0&&setShowResults(!0)}catch(o){console.error("Search failed:",o)}finally{y(!1)}},700)).current;a.useEffect(()=>()=>{v.cancel()},[v]);const S=s=>{const o=s.target.value;m(o),o.length<3?(p([]),setShowResults(!1)):(y(!0),v(o))},k=async(s,o=0)=>{try{const r=await(await fetch(`/api/charity-details/${s}/${o}`)).json();r.activities&&c(f=>({...f,description:r.activities}))}catch(h){console.error("Failed to fetch charity details:",h)}},C=s=>{c(o=>({...o,name:s.charity_name,charity_number:s.reg_charity_number,selected_charity_data:s})),m(s.charity_name),p([]),setShowResults(!1),s.reg_charity_number&&k(s.reg_charity_number,s.group_subsid_suffix||0)},R=async s=>{s.preventDefault();const o=new FormData,h={...i,...d};Object.keys(h).forEach(r=>{r==="selected_charity_data"&&h[r]?o.append(r,JSON.stringify(h[r])):h[r]!==null&&o.append(r,h[r])});try{const r=await fetch("/api/auth/organization/register/",{method:"POST",body:o}),f=await r.json();if(!r.ok)throw new Error(f.error||"Registration failed");g(f)}catch(r){u(r.message)}},D=e.jsxs("div",{className:"relative",ref:j,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Search Registered Charity"}),e.jsx("input",{type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter charity name or number (min 3 characters)",value:x,onChange:S,onFocus:()=>{w.length>0&&setShowResults(!0)}}),_&&e.jsx("div",{className:"absolute right-3 top-9",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),w.length>0&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto max-h-60",children:w.map(s=>e.jsxs("div",{className:"cursor-pointer hover:bg-gray-100 py-2 px-4",onClick:()=>C(s),children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.charity_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Charity Number: ",s.reg_charity_number,s.reg_status==="RM"&&e.jsx("span",{className:"ml-2 text-red-500",children:"(Removed)"})]}),s.date_of_registration&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Registered: ",new Date(s.date_of_registration).toLocaleDateString()]})]},`${s.reg_charity_number}-${s.organisation_number}`))})]});return e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[t&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 text-red-700 rounded",children:t}),e.jsx("div",{className:"mb-5",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex",children:[e.jsx("button",{onClick:()=>l(1),className:`${n===1?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm`,children:"Organization Details"}),e.jsx("button",{onClick:()=>l(2),className:`${n===2?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm`,children:"Admin User"})]})})}),e.jsx("form",{className:"space-y-6",onSubmit:R,children:n===1?e.jsxs(e.Fragment,{children:[D,e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{required:!0,rows:4,value:i.description,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>c({...i,description:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Organization Logo"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsxs("label",{className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[e.jsxs("span",{className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"-ml-1 mr-2 h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Choose File"]}),e.jsx("input",{type:"file",className:"sr-only",accept:"image/*",onChange:s=>c({...i,logo:s.target.files[0]})})]}),i.logo&&e.jsx("span",{className:"ml-3 text-sm text-gray-600",children:i.logo.name})]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:()=>l(2),className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Next"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("input",{type:"email",required:!0,value:d.email,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>b({...d,email:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Username"}),e.jsx("input",{type:"text",required:!0,value:d.username,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>b({...d,username:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsx("input",{type:"password",required:!0,value:d.password,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>b({...d,password:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),e.jsx("input",{type:"password",required:!0,value:d.password2,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:s=>b({...d,password2:s.target.value})})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>l(1),className:"w-1/2 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Back"}),e.jsx("button",{type:"submit",className:"w-1/2 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Register"})]})]})})]})},U=()=>{const g=F(),n=O(),{login:l}=P(),[i,c]=a.useState("volunteer"),[d,b]=a.useState({}),[t,u]=a.useState("");a.useEffect(()=>{var m;(m=g.state)!=null&&m.type&&c(g.state.type)},[g]);const x=m=>{localStorage.setItem("access_token",m.access),localStorage.setItem("refresh_token",m.refresh),l(m.user),m.user.is_volunteer?n("/browse"):n("/dashboard")};return e.jsx($,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Create your account"}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs("div",{className:"inline-flex rounded-md",role:"group",children:[e.jsx("button",{onClick:()=>c("volunteer"),className:`px-4 py-2 text-sm font-medium rounded-l-md ${i==="volunteer"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:"Volunteer"}),e.jsx("button",{onClick:()=>c("organization"),className:`px-4 py-2 text-sm font-medium rounded-r-md ${i==="organization"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:"Organization"})]})})]}),e.jsxs("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:[i==="volunteer"?e.jsx(T,{onRegisterSuccess:x}):e.jsx(M,{onRegisterSuccess:x}),e.jsxs("p",{className:"mt-6 text-center text-sm text-gray-600",children:["Already have an account?"," ",e.jsx(q,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500",children:"Sign in"})]})]})]})})},V=E(U);export{V as default};
