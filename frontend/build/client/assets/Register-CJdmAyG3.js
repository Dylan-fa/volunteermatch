import{w as ge}from"./proxy-Bff0xxqS.js";import{a as h,n as e,v as E,w as he,o as ue,x as xe,L as pe}from"./chunk-IR6S3I6Y-BEDlfGdp.js";import{b as ye,u as de}from"./UserContext-DHqOuuyH.js";import{P as ve}from"./PageTransition-DMUUi-KG.js";const je=({onRegisterSuccess:s})=>{const[r,o]=h.useState({email:"",password:"",password2:""}),[a,i]=h.useState(""),f=async l=>{l.preventDefault();try{const u=await fetch("/api/auth/volunteer/register/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),n=await u.json();if(!u.ok)throw new Error(n.error||"Registration failed");s(n)}catch(u){i(u.message)}},b=async l=>{try{const u=await fetch("/api/auth/google/callback/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_token:l.credential,user_type:"volunteer"})}),n=await u.json();if(!u.ok)throw new Error("Google registration failed");s(n)}catch(u){i(u.message)}};return e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[a&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 text-red-700 rounded",children:a}),e.jsx(ye,{onSuccess:b,onError:()=>i("Google registration failed"),className:"w-full mb-4",containerProps:{allow:"identity-credentials-get"},use_fedcm_for_prompt:!0}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with email"})})]}),e.jsxs("form",{className:"space-y-6",onSubmit:f,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email address"}),e.jsx("input",{id:"email",type:"email",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:l=>o({...r,email:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsx("input",{id:"password",type:"password",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:l=>o({...r,password:l.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password2",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),e.jsx("input",{id:"password2",type:"password",required:!0,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:l=>o({...r,password2:l.target.value})})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Sign up"})})]})]})};var L,X;function me(){if(X)return L;X=1;function s(r){var o=typeof r;return r!=null&&(o=="object"||o=="function")}return L=s,L}var P,K;function we(){if(K)return P;K=1;var s=typeof E=="object"&&E&&E.Object===Object&&E;return P=s,P}var F,Y;function fe(){if(Y)return F;Y=1;var s=we(),r=typeof self=="object"&&self&&self.Object===Object&&self,o=s||r||Function("return this")();return F=o,F}var G,Z;function Ne(){if(Z)return G;Z=1;var s=fe(),r=function(){return s.Date.now()};return G=r,G}var $,ee;function Se(){if(ee)return $;ee=1;var s=/\s/;function r(o){for(var a=o.length;a--&&s.test(o.charAt(a)););return a}return $=r,$}var M,re;function _e(){if(re)return M;re=1;var s=Se(),r=/^\s+/;function o(a){return a&&a.slice(0,s(a)+1).replace(r,"")}return M=o,M}var z,te;function be(){if(te)return z;te=1;var s=fe(),r=s.Symbol;return z=r,z}var A,se;function Te(){if(se)return A;se=1;var s=be(),r=Object.prototype,o=r.hasOwnProperty,a=r.toString,i=s?s.toStringTag:void 0;function f(b){var l=o.call(b,i),u=b[i];try{b[i]=void 0;var n=!0}catch{}var d=a.call(b);return n&&(l?b[i]=u:delete b[i]),d}return A=f,A}var U,ne;function ke(){if(ne)return U;ne=1;var s=Object.prototype,r=s.toString;function o(a){return r.call(a)}return U=o,U}var W,ae;function Re(){if(ae)return W;ae=1;var s=be(),r=Te(),o=ke(),a="[object Null]",i="[object Undefined]",f=s?s.toStringTag:void 0;function b(l){return l==null?l===void 0?i:a:f&&f in Object(l)?r(l):o(l)}return W=b,W}var B,oe;function Ce(){if(oe)return B;oe=1;function s(r){return r!=null&&typeof r=="object"}return B=s,B}var J,ie;function Oe(){if(ie)return J;ie=1;var s=Re(),r=Ce(),o="[object Symbol]";function a(i){return typeof i=="symbol"||r(i)&&s(i)==o}return J=a,J}var V,ce;function qe(){if(ce)return V;ce=1;var s=_e(),r=me(),o=Oe(),a=NaN,i=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,b=/^0o[0-7]+$/i,l=parseInt;function u(n){if(typeof n=="number")return n;if(o(n))return a;if(r(n)){var d=typeof n.valueOf=="function"?n.valueOf():n;n=r(d)?d+"":d}if(typeof n!="string")return n===0?n:+n;n=s(n);var p=f.test(n);return p||b.test(n)?l(n.slice(2),p?2:8):i.test(n)?a:+n}return V=u,V}var H,le;function Ee(){if(le)return H;le=1;var s=me(),r=Ne(),o=qe(),a="Expected a function",i=Math.max,f=Math.min;function b(l,u,n){var d,p,w,N,x,S,v=0,T=!1,k=!1,_=!0;if(typeof l!="function")throw new TypeError(a);u=o(u)||0,s(n)&&(T=!!n.leading,k="maxWait"in n,w=k?i(o(n.maxWait)||0,u):w,_="trailing"in n?!!n.trailing:_);function C(c){var y=d,O=p;return d=p=void 0,v=c,N=l.apply(O,y),N}function I(c){return v=c,x=setTimeout(R,u),T?C(c):N}function D(c){var y=c-S,O=c-v,Q=u-y;return k?f(Q,w-O):Q}function q(c){var y=c-S,O=c-v;return S===void 0||y>=u||y<0||k&&O>=w}function R(){var c=r();if(q(c))return t(c);x=setTimeout(R,D(c))}function t(c){return x=void 0,_&&d?C(c):(d=p=void 0,N)}function g(){x!==void 0&&clearTimeout(x),v=0,d=S=p=x=void 0}function j(){return x===void 0?N:t(r())}function m(){var c=r(),y=q(c);if(d=arguments,p=this,S=c,y){if(x===void 0)return I(S);if(k)return clearTimeout(x),x=setTimeout(R,u),C(S)}return x===void 0&&(x=setTimeout(R,u)),N}return m.cancel=g,m.flush=j,m}return H=b,H}var Ie=Ee();const De=he(Ie),Le=({onRegisterSuccess:s})=>{const[r,o]=h.useState(1),[a,i]=h.useState({name:"",charity_number:"",description:"",logo:null,selected_charity_data:null}),[f,b]=h.useState({email:"",username:"",password:"",password2:""}),[l,u]=h.useState(""),[n,d]=h.useState(""),[p,w]=h.useState([]),[N,x]=h.useState(!1),[S,v]=h.useState(!1),T=h.useRef(null);ue();const{login:k}=de();h.useEffect(()=>{const t=g=>{T.current&&!T.current.contains(g.target)&&v(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]);const _=h.useRef(De(async t=>{if(t.length<3){w([]),x(!1);return}x(!0);try{const m=(await(await fetch(`/api/charity-search/?q=${encodeURIComponent(t)}`)).json()).sort((c,y)=>c.reg_status==="RM"&&y.reg_status!=="RM"?1:c.reg_status!=="RM"&&y.reg_status==="RM"?-1:c.charity_name.localeCompare(y.charity_name));w(m),m&&m.length>0&&v(!0)}catch(g){console.error("Search failed:",g)}finally{x(!1)}},700)).current;h.useEffect(()=>()=>{_.cancel()},[_]);const C=t=>{const g=t.target.value;d(g),g.length<3?(w([]),v(!1)):(x(!0),_(g))},I=async(t,g=0)=>{try{const m=await(await fetch(`/api/charity-details/${t}/${g}`)).json();m.activities&&i(c=>({...c,description:m.activities}))}catch(j){console.error("Failed to fetch charity details:",j)}},D=t=>{i(g=>({...g,name:t.charity_name,charity_number:t.reg_charity_number,selected_charity_data:t})),d(t.charity_name),w([]),v(!1),t.reg_charity_number&&I(t.reg_charity_number,t.group_subsid_suffix||0)},q=async t=>{t.preventDefault();const g=new FormData,j={...a,...f};Object.keys(j).forEach(m=>{m==="selected_charity_data"&&j[m]?g.append(m,JSON.stringify(j[m])):j[m]!==null&&g.append(m,j[m])});try{const m=await fetch("/api/auth/organization/register/",{method:"POST",body:g}),c=await m.json();if(!m.ok)throw new Error(c.error||"Registration failed");s(c)}catch(m){u(m.message)}},R=e.jsxs("div",{className:"relative",ref:T,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Search Registered Charity"}),e.jsx("input",{type:"text",className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter charity name or number (min 3 characters)",value:n,onChange:C,onFocus:()=>{p.length>0&&v(!0)}}),N&&e.jsx("div",{className:"absolute right-3 top-9",children:e.jsxs("svg",{className:"animate-spin h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),p.length>0&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto max-h-60",children:p.map(t=>e.jsxs("div",{className:"cursor-pointer hover:bg-gray-100 py-2 px-4",onClick:()=>D(t),children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.charity_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Charity Number: ",t.reg_charity_number,t.reg_status==="RM"&&e.jsx("span",{className:"ml-2 text-red-500",children:"(Removed)"})]}),t.date_of_registration&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Registered: ",new Date(t.date_of_registration).toLocaleDateString()]})]},`${t.reg_charity_number}-${t.organisation_number}`))})]});return e.jsxs("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:[l&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 text-red-700 rounded",children:l}),e.jsx("div",{className:"mb-5",children:e.jsx("div",{className:"border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex",children:[e.jsx("button",{onClick:()=>o(1),className:`${r===1?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm`,children:"Organization Details"}),e.jsx("button",{onClick:()=>o(2),className:`${r===2?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} w-1/2 py-4 px-1 text-center border-b-2 font-medium text-sm`,children:"Admin User"})]})})}),e.jsx("form",{className:"space-y-6",onSubmit:q,children:r===1?e.jsxs(e.Fragment,{children:[R,e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{required:!0,rows:4,value:a.description,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>i({...a,description:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Organization Logo"}),e.jsxs("div",{className:"mt-1 flex items-center",children:[e.jsxs("label",{className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500",children:[e.jsxs("span",{className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx("svg",{className:"-ml-1 mr-2 h-5 w-5 text-gray-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),"Choose File"]}),e.jsx("input",{type:"file",className:"sr-only",accept:"image/*",onChange:t=>i({...a,logo:t.target.files[0]})})]}),a.logo&&e.jsx("span",{className:"ml-3 text-sm text-gray-600",children:a.logo.name})]})]}),e.jsx("div",{children:e.jsx("button",{type:"button",onClick:()=>o(2),className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Next"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email Address"}),e.jsx("input",{type:"email",required:!0,value:f.email,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>b({...f,email:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Username"}),e.jsx("input",{type:"text",required:!0,value:f.username,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>b({...f,username:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Password"}),e.jsx("input",{type:"password",required:!0,value:f.password,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>b({...f,password:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),e.jsx("input",{type:"password",required:!0,value:f.password2,className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500",onChange:t=>b({...f,password2:t.target.value})})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{type:"button",onClick:()=>o(1),className:"w-1/2 py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Back"}),e.jsx("button",{type:"submit",className:"w-1/2 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Register"})]})]})})]})},Pe=()=>{const s=xe(),r=ue(),{login:o}=de(),[a,i]=h.useState("volunteer"),[f,b]=h.useState({}),[l,u]=h.useState("");h.useEffect(()=>{var d;(d=s.state)!=null&&d.type&&i(s.state.type)},[s]);const n=d=>{localStorage.setItem("access_token",d.access),localStorage.setItem("refresh_token",d.refresh),o(d.user),d.user.is_volunteer?r("/browse"):r("/dashboard")};return e.jsx(ve,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Create your account"}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsxs("div",{className:"inline-flex rounded-md",role:"group",children:[e.jsx("button",{onClick:()=>i("volunteer"),className:`px-4 py-2 text-sm font-medium rounded-l-md ${a==="volunteer"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:"Volunteer"}),e.jsx("button",{onClick:()=>i("organization"),className:`px-4 py-2 text-sm font-medium rounded-r-md ${a==="organization"?"bg-blue-600 text-white":"bg-white text-gray-700 hover:bg-gray-50"}`,children:"Organization"})]})})]}),e.jsxs("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:[a==="volunteer"?e.jsx(je,{onRegisterSuccess:n}):e.jsx(Le,{onRegisterSuccess:n}),e.jsxs("p",{className:"mt-6 text-center text-sm text-gray-600",children:["Already have an account?"," ",e.jsx(pe,{to:"/login",className:"font-medium text-blue-600 hover:text-blue-500",children:"Sign in"})]})]})]})})},ze=ge(Pe);export{ze as default};
